# InsightAgent: Kafka Incident
Agent Type: Kafka Incident

Platform: Linux

This agent is used to collect incident data from kafka.

##### Instructions to register a project in Insightfinder.com
- Go to the link https://insightfinder.com/
- Sign in with the user credentials or sign up for a new account.
- Go to Settings and create a project.
- Select InsightAgent as the Data Source on the next page.
- Using the dropdowns on the next page, select "Custom" as the Instance Type, "Incident" as the Data Type, and "Live Streaming" as the Agent Type
- Note your license key which is available in "User Account Information". To get to "User Account Information", click on the username on the top right corner.

##### Pre-requisites:
Python 2.7
SSH accesses to all hosts where agents will be installed are required. SSH key can be generated by following this link:
https://www.ssh.com/ssh/keygen/

Tested with ansible version 2.2.3.0

Kafka should be installed and accessible on port 9092 (This can be changed via the configuration file). The default topic name the agent consumes from is ***"insightfinder_logs"***.

### Install wget to download the required files:
#### For Debian and Ubuntu
```
sudo -E apt-get update
sudo -E apt-get install wget
```
#### For Fedora and RHEL-derivatives
```
sudo -E yum update
sudo -E yum install wget
```
Note: If you are using proxy, the proxy needs to be set for both the current user and root.

#### Installation:
1) Use the following command to download the insightfinder agent code. You can skip this step if you have the offline installer package.
```
wget --no-check-certificate https://github.com/insightfinder/InsightAgent/archive/master.tar.gz -O insightagent.tar.gz
or
wget --no-check-certificate http://github.com/insightfinder/InsightAgent/archive/master.tar.gz -O insightagent.tar.gz
```

Untar using this command.
```
tar -xvf insightagent.tar.gz
cd InsightAgent-master/
```

If you do not need to distribute the replay script, you can skip to **Sending Data** below.

2) Download the agent Code which will be distributed to other machines(not required if you have the offline installation package)
```
cd deployment/DeployAgent/files/
sudo -E ./downloadAgentSSL.sh
# or
sudo -E ./downloadAgentNoSSL.sh
```

3) Install Ansible, if this the first agent you are installing from this machine.
```
cd ..
sudo -E ./installAnsible.sh
```

4) Open and modify the inventory file
```
# vi inventory
[nodes]
HOST ansible_user=USER ansible_ssh_private_key_file=SOMETHING
###We can specify the host name with ssh details like this for each host
##If you have the ssh key
#192.168.33.10 ansible_user=vagrant ansible_ssh_private_key_file=/home/private_key

##If you have the password
#192.168.33.20 ansible_user=vagrant ansible_ssh_pass=ssh_password


##We can also specify the host names here and the ssh details under [nodes:vars] if they have have the same ssh credentials
##(Only one of ansible_ssh_pass OR ansible_ssh_private_key_file is required)
#192.168.33.10
#192.168.33.15

[nodes:vars]
#ansible_user=vagrant
#ansible_ssh_pass=ssh_password
#ansible_ssh_private_key_file=/home/private_key

[all:vars]
##install or uninstall
ifAction=install

##Login User In Insightfinder Application
ifUserName=

##Project Name In Insightfinder Application
ifProjectName=

##User's License Key in Application
ifLicenseKey=

##Sampling interval could be an integer indicating the number of minutes or "10s" indicating 10 seconds.
ifSamplingInterval=1

##Agent type
#
ifAgent=kafka-incident
#

##The server reporting Url(Do not change unless you have on-prem deployment)
ifReportingUrl=https://app.insightfinder.com

##Vars for Kafka

# Bootstrap server list for kafka
# e.g. host:9092,host2:9092
kafkaBootstrapServers = localhost:9092

kafkaIncidentTopic = insightfinder_logs

filterHosts =
```

5) Run the playbook
```
ansible-playbook insightagent.yaml
```

### Uninstallation:
Note: Uninstallation is required before you can install any other Metric agent(e.g. cgroup) or you want to reinstall the current collectd agent.

1) Open and modify the inventory file
```
[all:vars]
##install or uninstall
ifAction=uninstall
```

2) Run the playbook
```
ansible-playbook insightagent.yaml
```
